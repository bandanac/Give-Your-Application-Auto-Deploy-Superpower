# starter code circleCI
# Use the latest 2.1 version of CircleCI pipeline process engine. See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

jobs:
  print_hello:
    docker:
      - image: circleci/node:13.8.0
    steps:
      - run: echo hello
  print_world:
    docker:
      - image: circleci/node:13.8.0
    steps:
      - run: echo world
  build_backend:
    docker:
      - image: circleci/node:13.8.0
    steps:
      - checkout
      - run: cd backend && npm i
      - run: cd backend && npm run lint
  build_frontend:
    docker:
      - image: circleci/node:13.8.0
    steps:
      - checkout
      - run: cd frontend && npm i
      - run: cd frontend && npm run lint
  test_backend:
    docker:
      - image: circleci/node:13.8.0
    steps:
      - checkout
      - run: yarn install
      - run:
        name: Install JUnit coverage reporter
        command: yarn add --dev jest-junit
      - run:
        name: Run tests with JUnit as reporter
        command: jest --ci --runInBand --reporters=default --reporters=jest-junit
        environment:
          JEST_JUNIT_OUTPUT_DIR: ./reports/junit/
      - store_test_results:
        path: ./reports/junit/
      - store_artifacts:
        path: ./reports/junit
workflows:
  # Name the workflow "welcome"
  welcome:
    # Run the welcome/run job in its own container
    jobs:
      - test_backend
      # - print_hello
      # - print_world:
      #     requires:
      #       - print_hello
      # - build_backend:
      #     requires:
      #       - print_world
      # - build_frontend:
      #     requires:
      #       - build_backend

# version: 2.1

# jobs:
#   hello-world:
#     docker:
#       - image: amazon/aws-cli
#     steps:
#       - checkout
#       - run:
#           name: Say Hello
#           command: |
#             echo "Hello World"

# workflows:
#   default:
#     jobs:
#       - hello-world
